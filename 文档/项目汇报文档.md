# 图书智能检索系统 - 项目汇报文档

## 📋 项目概述

### 项目名称
图书智能检索系统 (Intelligent Book Search System)

### 项目简介
本项目是一个基于AI技术的智能图书检索系统，集成了自然语言处理、语义搜索和智能推荐功能。用户可以通过自然语言与系统对话，实现图书查询、推荐和信息检索，系统能够理解用户意图并提供精准的图书信息。

### 开发周期
2025年11月（持续开发中）

### 技术栈
- **前端**: Blazor WebAssembly + MudBlazor UI组件库
- **后端**: ASP.NET Core Web API (.NET 8.0)
- **数据库**: SQL Server (Docker容器化部署)
- **AI引擎**: Ollama + Semantic Kernel + Qwen2.5:7b模型
- **开发工具**: Windsurf IDE (AI辅助开发)

---

## 🎯 项目目标

### 核心目标
1. **智能对话**: 用户通过自然语言与系统交互，无需学习复杂的查询语法
2. **精准检索**: 基于AI理解用户意图，提供精准的图书搜索结果
3. **智能推荐**: 根据用户需求和偏好，智能推荐相关图书
4. **数据驱动**: 所有功能基于真实数据库数据，确保信息准确性

### 创新点
1. **AI自动生成SQL**: 系统能够根据用户的自然语言需求，自动生成SQL查询语句
2. **上下文理解**: AI能够理解对话上下文，提供连贯的多轮对话体验
3. **函数调用机制**: 集成Semantic Kernel的函数调用功能，实现AI与数据库的智能交互

---

## 🏗️ 系统架构

### 整体架构
```
┌─────────────────────────────────────────────────────────┐
│                    用户浏览器                              │
│                 (http://localhost:5000)                  │
└────────────────────┬────────────────────────────────────┘
                     │ HTTP请求
                     ↓
┌─────────────────────────────────────────────────────────┐
│              Blazor WebAssembly 前端                      │
│  ┌─────────────┐  ┌──────────────┐  ┌────────────────┐ │
│  │  聊天界面   │  │  图书搜索    │  │  推荐系统      │ │
│  └─────────────┘  └──────────────┘  └────────────────┘ │
│  ┌──────────────────────────────────────────────────┐  │
│  │         ChatService / BookService                 │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────────────┘
                     │ API调用
                     ↓
┌─────────────────────────────────────────────────────────┐
│           ASP.NET Core Web API 后端                       │
│              (http://localhost:5001)                     │
│  ┌──────────────┐  ┌───────────────┐  ┌──────────────┐ │
│  │ChatController│  │BooksController│  │  CORS配置    │ │
│  └──────┬───────┘  └───────┬───────┘  └──────────────┘ │
│         │                  │                             │
│  ┌──────▼──────────────────▼───────────────────────┐   │
│  │           KernelService (AI核心服务)             │   │
│  │  ┌────────────────┐  ┌──────────────────────┐  │   │
│  │  │BookSearchPlugin│  │  SqlQueryPlugin      │  │   │
│  │  └────────────────┘  └──────────────────────┘  │   │
│  └──────────────────────┬───────────────────────────┘   │
│                         │                                │
│  ┌──────────────────────▼───────────────────────────┐   │
│  │        DatabaseService / AdvancedDatabaseService │   │
│  └──────────────────────┬───────────────────────────┘   │
└─────────────────────────┼─────────────────────────────┘
                          │ SQL查询
                          ↓
┌─────────────────────────────────────────────────────────┐
│              SQL Server 数据库                            │
│                  (Docker容器)                             │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Books表: 图书信息(书名、作者、价格、库存等)      │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────────┐
│              Ollama AI 服务                               │
│           (http://localhost:11434)                       │
│              Qwen2.5:7b 模型                              │
└─────────────────────────────────────────────────────────┘
```

### 技术架构说明

#### 前端层 (Blazor WebAssembly)
- **UI框架**: MudBlazor v8.13.0，提供现代化的Material Design界面
- **服务层**: ChatService和BookService处理业务逻辑
- **通信**: 通过HttpClient与后端API通信，超时时间设置为5分钟

#### 后端层 (ASP.NET Core Web API)
- **控制器**: ChatController和BooksController处理HTTP请求
- **AI服务**: KernelService集成Semantic Kernel，协调AI功能
- **插件系统**:
  - BookSearchPlugin: 关键词搜索
  - SqlQueryPlugin: 复杂SQL查询生成和执行
- **数据访问**: DatabaseService和AdvancedDatabaseService

#### 数据层 (SQL Server)
- **容器化部署**: 使用Docker运行SQL Server 2019
- **数据表**: Books表存储图书完整信息
- **连接管理**: 统一使用BookDatabase连接字符串

#### AI层 (Ollama + Semantic Kernel)
- **模型**: Qwen2.5:7b，7B参数的中文优化模型
- **框架**: Microsoft Semantic Kernel，提供函数调用能力
- **端点**: http://localhost:11434/v1 (OpenAI兼容API)

---

## 🔧 核心功能

### 1. 智能聊天功能
**功能描述**: 用户通过自然语言与系统对话，查询图书信息

**实现方式**:
- 用户输入自然语言问题
- Semantic Kernel分析用户意图
- 自动选择合适的工具（关键词搜索或SQL查询）
- 返回格式化的图书信息和AI生成的友好回复

**技术亮点**:
- 支持多轮对话，保持上下文
- 自动识别复杂查询需求（如"最便宜的书"）
- 实时流式响应，提升用户体验

### 2. 关键词搜索
**功能描述**: 基于书名、作者、分类进行模糊搜索

**实现方式**:
```csharp
// BookSearchPlugin
public async Task<string> SearchBooks(string keyword)
{
    // 在数据库中搜索匹配的图书
    var books = await _databaseService.SearchBooksAsync(keyword);
    // 返回格式化结果
}
```

**支持查询**:
- "Python相关的书"
- "作者是XXX的书"
- "机器学习类别的书"

### 3. 智能SQL查询 ⭐创新功能
**功能描述**: AI自动生成SQL语句，执行复杂查询

**实现方式**:
```csharp
// SqlQueryPlugin
1. GetDatabaseSchema() - 获取数据库表结构
2. ExecuteSqlQuery(sqlQuery) - 执行生成的SQL
```

**支持查询**:
- "最便宜的10本书"
- "价格在50-100元之间的书"
- "库存最多的书"
- "某个分类中价格最低的书"

**安全机制**:
- ✅ 只允许SELECT语句
- ✅ 阻止DROP、DELETE、UPDATE等危险操作
- ✅ SQL注入防护
- ✅ 超时保护（30秒）

### 4. 图书推荐
**功能描述**: 根据用户需求推荐相关图书

**实现方式**:
- 从数据库随机推荐图书
- 基于分类推荐相似图书
- 结合AI理解用户偏好

### 5. 图书详情查询
**功能描述**: 查询特定图书的详细信息

**返回信息**:
- 书名、作者、出版社
- ISBN、出版日期
- 价格、库存
- 图书描述

---

## 💾 数据库设计

### Books表结构
```sql
CREATE TABLE Books (
    BookID INT PRIMARY KEY IDENTITY(1,1),      -- 图书ID
    Title NVARCHAR(200) NOT NULL,              -- 书名
    Author NVARCHAR(100) NOT NULL,             -- 作者
    Publisher NVARCHAR(100),                   -- 出版社
    PublishDate DATE,                          -- 出版日期
    ISBN VARCHAR(20),                          -- ISBN编号
    Category NVARCHAR(50),                     -- 分类
    Price DECIMAL(10,2),                       -- 价格
    Stock INT DEFAULT 0,                       -- 库存
    Description NVARCHAR(MAX),                 -- 描述
    CreatedAt DATETIME DEFAULT GETDATE()       -- 创建时间
);
```

### 数据示例
系统包含多种分类的图书数据：
- Python编程
- Java开发
- 机器学习
- 数据库
- Web开发
- 等等...

---

## 🚀 部署架构

### 开发环境配置
```
前端端口: http://localhost:5000
后端端口: http://localhost:5001
数据库端口: localhost:1433
AI服务端口: http://localhost:11434
```

### Docker容器
```bash
# SQL Server容器
容器名: sqlserver2
镜像: mcr.microsoft.com/mssql/server:2019-latest
端口映射: 1433:1433
```

### 启动流程
1. 启动Docker Desktop
2. 启动SQL Server容器
3. 启动Ollama AI服务
4. 启动后端API (端口5001)
5. 启动前端应用 (端口5000)

---

## 🎨 用户界面

### 主要页面
1. **聊天页面**: 与AI对话，查询图书
2. **搜索页面**: 传统搜索界面
3. **推荐页面**: 图书推荐展示
4. **详情页面**: 图书详细信息

### UI特点
- Material Design风格
- 响应式布局
- 实时消息流
- 图书卡片展示
- 加载状态提示

---

## 🔐 安全性设计

### 1. SQL注入防护
- 使用参数化查询
- 严格验证SQL语句类型
- 阻止危险关键字

### 2. CORS配置
```csharp
// 只允许特定来源
policy.WithOrigins("http://localhost:5000", "https://localhost:5001")
      .AllowAnyMethod()
      .AllowAnyHeader();
```

### 3. 数据库安全
- 使用强密码
- 容器隔离
- 连接字符串加密存储

### 4. API安全
- 请求超时限制
- 错误信息脱敏
- 详细日志记录

---

## 📊 性能优化

### 1. 前端优化
- 超时时间延长至5分钟（适应AI响应时间）
- 组件懒加载
- 状态管理优化

### 2. 后端优化
- 异步编程模型
- 数据库连接池
- 响应缓存

### 3. AI优化
- 模型选择：Claude 3.5 Sonnet（编码任务最优）
- 温度参数：0.7（平衡创造性和准确性）
- Token限制：2000（控制响应长度）

### 4. 数据库优化
- 索引优化
- 查询性能监控
- 连接超时设置

---

## 🐛 问题解决记录

### 已解决的关键问题

#### 1. 数据库连接问题
**问题**: 配置名称不一致导致连接失败
**解决**: 统一使用`BookDatabase`连接字符串名称

#### 2. 端口冲突
**问题**: 端口被占用导致启动失败
**解决**: 固定端口配置，冲突时关闭占用进程

#### 3. CORS错误
**问题**: 前端无法访问后端API
**解决**: 配置正确的CORS策略，允许5000和5001端口

#### 4. Ollama API 404错误
**问题**: Semantic Kernel无法连接Ollama
**解决**: 使用正确的端点路径`/v1`

#### 5. 请求超时
**问题**: AI响应时间长导致请求中断
**解决**: 增加HttpClient超时时间至5分钟

详细问题记录请参考：`文档/开发经验总结-避坑指南.md`

---

## 📈 项目成果

### 实现的功能
✅ 智能对话系统  
✅ 关键词搜索  
✅ AI自动生成SQL查询  
✅ 图书推荐  
✅ 图书详情查询  
✅ 现代化UI界面  
✅ 容器化部署  
✅ 完整的错误处理  

### 技术突破
✅ 成功集成Semantic Kernel框架  
✅ 实现AI函数调用机制  
✅ 创新的SQL自动生成功能  
✅ 完整的前后端分离架构  

### 文档产出
✅ 开发经验总结文档  
✅ 数据库启动说明  
✅ API使用文档  
✅ 项目汇报文档  

---

## 🔮 未来规划

### 短期目标（1-2周）
- [ ] 添加用户认证系统
- [ ] 实现图书借阅功能
- [ ] 优化AI响应速度
- [ ] 添加图书封面展示

### 中期目标（1个月）
- [ ] 实现个性化推荐算法
- [ ] 添加图书评论功能
- [ ] 支持多语言界面
- [ ] 移动端适配

### 长期目标（3个月）
- [ ] 集成更多AI模型
- [ ] 实现语音交互
- [ ] 添加图书管理后台
- [ ] 部署到云服务器

---

## 💡 技术亮点总结

### 1. AI驱动的智能交互
- 自然语言理解
- 上下文保持
- 智能意图识别

### 2. 创新的SQL生成机制
- AI自动理解数据库结构
- 根据需求生成SQL
- 安全执行和结果返回

### 3. 现代化技术栈
- .NET 8.0最新框架
- Blazor WebAssembly前沿技术
- Docker容器化部署

### 4. 完整的工程实践
- 前后端分离
- RESTful API设计
- 详细的错误处理和日志
- 完善的文档体系

---

## 📚 参考资料

### 技术文档
- [ASP.NET Core官方文档](https://docs.microsoft.com/aspnet/core)
- [Blazor官方文档](https://docs.microsoft.com/aspnet/core/blazor)
- [Semantic Kernel文档](https://learn.microsoft.com/semantic-kernel)
- [Ollama文档](https://ollama.ai/docs)

### 项目文档
- `文档/开发经验总结-避坑指南.md`
- `数据库启动说明.md`
- `database/InitDatabase.sql`

---

## 👥 项目信息

**开发者**: [你的姓名]  
**指导老师**: [老师姓名]  
**开发时间**: 2025年11月  
**项目地址**: `c:\Users\LQQ\Desktop\图书智能检索系统`

---

## 📞 联系方式

如有问题或建议，请联系：
- 邮箱: [你的邮箱]
- GitHub: [你的GitHub]

---

**感谢老师的指导与支持！**
