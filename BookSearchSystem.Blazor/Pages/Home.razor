@page "/"
@using BookSearchSystem.Blazor.Services
@using BookSearchSystem.Blazor.Models
@inject IBookService BookService
@inject NavigationManager Navigation

<PageTitle>é¦–é¡µ - å›¾ä¹¦æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large">
    <!-- Hero Section -->
    <MudPaper Elevation="0" Class="pa-8 mb-4" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <MudText Typo="Typo.h3" Align="Align.Center" Class="mb-2">ğŸ“š å›¾ä¹¦æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ</MudText>
        <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-4">æ™ºèƒ½å¯¹è¯ Â· ç²¾å‡†æœç´¢ Â· ä¸ªæ€§æ¨è</MudText>
        
        <div class="d-flex justify-center gap-4">
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Surface" 
                       Size="Size.Large"
                       StartIcon="@Icons.Material.Filled.Chat"
                       Href="/chat">
                å¼€å§‹å¯¹è¯
            </MudButton>
            <MudButton Variant="Variant.Outlined" 
                       Style="color: white; border-color: white;"
                       Size="Size.Large"
                       StartIcon="@Icons.Material.Filled.Search"
                       Href="/search">
                æœç´¢å›¾ä¹¦
            </MudButton>
        </div>
    </MudPaper>

    <!-- Quick Actions -->
    <MudText Typo="Typo.h5" Class="mb-3">å¿«æ·æ“ä½œ</MudText>
    <MudGrid Class="mb-4">
        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2" Class="pa-4" Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/chat"))">
                <MudCardContent Class="text-center">
                    <MudIcon Icon="@Icons.Material.Filled.Chat" Size="Size.Large" Color="Color.Primary" Class="mb-2" />
                    <MudText Typo="Typo.h6">æ™ºèƒ½å¯¹è¯</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">ä¸AIåŠ©æ‰‹å¯¹è¯æŸ¥è¯¢</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2" Class="pa-4" Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/search"))">
                <MudCardContent Class="text-center">
                    <MudIcon Icon="@Icons.Material.Filled.Search" Size="Size.Large" Color="Color.Secondary" Class="mb-2" />
                    <MudText Typo="Typo.h6">é«˜çº§æœç´¢</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">å¤šæ¡ä»¶ç²¾å‡†æœç´¢</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2" Class="pa-4" Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/favorites"))">
                <MudCardContent Class="text-center">
                    <MudIcon Icon="@Icons.Material.Filled.Favorite" Size="Size.Large" Color="Color.Error" Class="mb-2" />
                    <MudText Typo="Typo.h6">æˆ‘çš„æ”¶è—</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">æŸ¥çœ‹æ”¶è—çš„å›¾ä¹¦</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
        
        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2" Class="pa-4" Style="cursor: pointer;" @onclick="@(() => Navigation.NavigateTo("/statistics"))">
                <MudCardContent Class="text-center">
                    <MudIcon Icon="@Icons.Material.Filled.BarChart" Size="Size.Large" Color="Color.Success" Class="mb-2" />
                    <MudText Typo="Typo.h6">ç»Ÿè®¡åˆ†æ</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">æŸ¥çœ‹æ•°æ®ç»Ÿè®¡</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Recommended Books -->
    <MudText Typo="Typo.h5" Class="mb-3">æ¨èå›¾ä¹¦</MudText>
    @if (isLoading)
    {
        <div class="d-flex justify-center pa-8">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" />
        </div>
    }
    else if (recommendedBooks.Any())
    {
        <MudGrid>
            @foreach (var book in recommendedBooks.Take(8))
            {
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <BookCard Book="@book" OnAddToFavorites="HandleAddToFavorites" />
                </MudItem>
            }
        </MudGrid>
    }
    else
    {
        <MudAlert Severity="Severity.Info">æš‚æ— æ¨èå›¾ä¹¦</MudAlert>
    }
</MudContainer>

@code {
    private List<Book> recommendedBooks = new();
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadRecommendedBooks();
    }

    private async Task LoadRecommendedBooks()
    {
        isLoading = true;
        try
        {
            recommendedBooks = await BookService.GetRecommendedBooksAsync(8);
        }
        catch (Exception)
        {
            // Handle error silently for demo
        }
        finally
        {
            isLoading = false;
        }
    }

    private Task HandleAddToFavorites(int bookId)
    {
        // TODO: Implement favorites functionality
        return Task.CompletedTask;
    }
}
