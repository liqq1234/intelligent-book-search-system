@using BookSearchSystem.Blazor.Models

<div class="chat-message @(Message.Role == "user" ? "user-message" : "assistant-message")">
    <div class="d-flex align-start @(Message.Role == "user" ? "flex-row-reverse" : "")">
        <MudAvatar Color="@(Message.Role == "user" ? Color.Primary : Color.Secondary)" 
                   Class="@(Message.Role == "user" ? "ml-2" : "mr-2")">
            @if (Message.Role == "user")
            {
                <MudIcon Icon="@Icons.Material.Filled.Person" />
            }
            else
            {
                <MudIcon Icon="@Icons.Material.Filled.SmartToy" />
            }
        </MudAvatar>
        
        <div class="message-content" style="max-width: 70%;">
            <MudPaper Elevation="1" Class="pa-3" Style="@GetMessageStyle()">
                <MudText Typo="Typo.body1" Style="white-space: pre-wrap;">@Message.Content</MudText>
                
                @if (Message.Books != null && Message.Books.Any())
                {
                    <MudDivider Class="my-3" />
                    <MudText Typo="Typo.subtitle2" Class="mb-2">找到 @Message.Books.Count 本相关图书:</MudText>
                    
                    <MudGrid>
                        @foreach (var book in Message.Books)
                        {
                            <MudItem xs="12" sm="6" md="4">
                                <MudCard Elevation="0" Outlined="true">
                                    <MudCardContent Class="pa-2">
                                        <MudText Typo="Typo.body2" Class="font-weight-bold">@book.Title</MudText>
                                        <MudText Typo="Typo.caption">@book.Author</MudText>
                                        <div class="d-flex justify-space-between align-center mt-1">
                                            <MudText Typo="Typo.body2" Color="Color.Primary">¥@book.Price</MudText>
                                            <MudChip T="string" Size="Size.Small" Color="@(book.Stock > 0 ? Color.Success : Color.Error)">
                                                @(book.Stock > 0 ? $"库存:{book.Stock}" : "缺货")
                                            </MudChip>
                                        </div>
                                    </MudCardContent>
                                    <MudCardActions Class="pa-2">
                                        <MudButton Size="Size.Small" Variant="Variant.Text" Color="Color.Primary" Href="@($"/book/{book.BookId}")">
                                            详情
                                        </MudButton>
                                    </MudCardActions>
                                </MudCard>
                            </MudItem>
                        }
                    </MudGrid>
                }
                
                <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mt-2">
                    @Message.Timestamp.ToString("HH:mm:ss")
                </MudText>
            </MudPaper>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public ChatMessageModel Message { get; set; } = null!;
    
    private string GetMessageStyle()
    {
        return Message.Role == "user" 
            ? "background-color: var(--mud-palette-primary); color: white;" 
            : "background-color: var(--mud-palette-background-grey);";
    }
}

<style>
    .chat-message {
        margin-bottom: 16px;
    }
    
    .message-content {
        flex: 1;
    }
</style>
